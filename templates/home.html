{% extends 'base.html' %}

{% block style %}
  <style>
    #map {height: 400px; width: 100%;}
    .gsdf {
      position: absolute; top: 50%; left: 50%; height: 50%;
      transform: translate(-50%, -50%);
      display: block;
    }
  </style>
{% endblock %}

{% block body %}
  <div id="map" class="marketing"></div>
  <meta id="schools" data="{{schools}}">
  <script>  

    function initMap(schools) {
      var kehillah = {lat: 37.424910, lng: -122.104568};
      var center = {lat: 40.819934, lng: -96.701856};
      //var point = { Kehillah: {lat: 37.424910, lng: -122.104568}};
      var map = new google.maps.Map(document.getElementById('map'), {zoom: 4, center: center, streetViewControl: false});
    
      //console.log(data);

        // This example uses a local copy of the GeoJSON stored at
        // http://earthquake.usgs.gov/earthquakes/feed/v1.0/summary/2.5_week.geojsonp

      var marker2 = new google.maps.Marker({position: kehillah, map: map});
      var marker = new google.maps.Marker({position: kehillah, map: map});
      //var infowindow = new google.maps.InfoWindow({content:"Kehillah Jewish High School"});
      //google.maps.event.addListener(marker, 'click', function() {infowindow.open(map, marker);});
    }
    function JSONloader(input) {
      this.input 	= input;
      this.data 	= {};
      this.init();
    }
    JSONloader.prototype.init = function() {
      document.getElementById(this.input).addEventListener('change', this.read);
    }
    JSONloader.prototype.read = function(e) {
      var el = e.target;
      if(el.files && el.files[0]) {
        var reader = new FileReader();
        reader.onload = function(e) {
          var data = window.atob(e.target.result.replace('data:;base64,', ''));
          console.log(data);
        }
        reader.readAsDataURL(el.files[0]);
      }
    }

  </script>
  <script async defer 
    src="https://maps.googleapis.com/maps/api/js?key=AIzaSyB65Hg1ByHjRCA3riW0ShafytFRCSUOm6U&callback=initMap">
  </script>

  <!-- Description Divider -->
  <div class="jumbotron" style="padding: 15px">

    <!-- Search Bar -->
    <div style="float: right;">
      <form class="navbar-form" role="search">
        <div class="input-group add-on">
          <input class="form-control" placeholder="Search" name="query" id="query" type="text">
          <div class="input-group-btn">
            <button id="querybutton" class="btn btn-default" type="submit" style="height: 34px; width: 34px"><span class="glyphicon glyphicon-search" style="font-size: 12pt; position: absolute; top: 50%; left: 50%; height: 50%; transform: translate(-50%, -50%);"></span></button>
          </div>
        </div>
      </form>
    </div>
    <script>
      // Search Result Page
      $("#querybutton").click(function() {
        event.preventDefault();
        var searchstring = $('#query').focus().val();
        $("#query").closest('form').find("input[type=text], textarea").val(""); // empty query
        var searchresults = '<h3>Results for "' + searchstring + '":</h3><br>';
        for (i = 0; i < 5; i++) {
          searchresults = searchresults + "\
            <br>\
            <div style='height: 100%; border-radius: 6px; padding: 20px; background-color: #d0d0d0'>\
              <h3 style='text-align: left; font-size: 14pt !important; margin: 0px !important;'><a id='school'>Kehillah Jewish High School</a></h3>\
              <p style='text-align: left; font-size: 12pt !important; margin-top: 10px !important; margin-bottom: 0px !important;'>Private Jewish High School</p>\
              <p style='text-align: left; font-size: 12pt !important; margin-top: 10px !important; margin-bottom: 0px !important;'>Palo Alto, California</p>\
            </div>";
        }
        var $elem = $('#center');
        $elem.empty();
        $elem.append(searchresults);
      });

      // Individual School Page
      $(document).on('click', '#school', function(){ 
        event.preventDefault(); 
        var schoolname = $('#school').text()
        var result = '<h3>' + schoolname + '</h3><br>';
        var $elem = $('#center');
        $elem.empty();
        $elem.append(result);
      });
      
    </script>

    <!-- School Description -->
    <div id="center" class="jumbotron" style="padding: 20px 20px">
      <h2 style="margin: 30px 0px 0px 0px;">Welcome to College Index!<h2>
      <p style="font-size: 16pt !important; line-height: 30px; margin: 0px;">
        Thank you for using this tool for your college research. Please enter a college into the search bar or find its location on the map to see student reviews.
      </p>
    </div>

  </div>
{% endblock %}